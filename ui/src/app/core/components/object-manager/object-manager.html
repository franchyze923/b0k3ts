<mat-card class="om-card">
  <mat-card-header>
    <mat-card-title>Object Manager</mat-card-title>
    <mat-card-subtitle>
      Manage bucket objects: list, upload, delete, move
      <mat-chip-set class="chips" aria-label="Object stats">
        <mat-chip>{{ objectCount() }} objects</mat-chip>
        <mat-chip>Bucket: {{ selectedBucket() }}</mat-chip>
      </mat-chip-set>
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <div class="toolbar-row">
      <mat-form-field appearance="outline" class="bucket-select">
        <mat-label>Bucket</mat-label>
        <mat-select
          [ngModel]="selectedBucket()"
          (ngModelChange)="selectedBucket.set($event)"
        >
          <mat-option *ngFor="let b of buckets()" [value]="b">{{ b }}</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-stroked-button type="button" (click)="refresh()">
        <mat-icon aria-hidden="true">refresh</mat-icon>
        Refresh
      </button>

      <label class="upload-btn">
        <input type="file" multiple (change)="onUploadFiles($any($event.target).files)" />
        <button mat-flat-button color="primary" type="button">
          <mat-icon aria-hidden="true">upload</mat-icon>
          Upload
        </button>
      </label>
    </div>

    <div class="table-wrap">
      <table mat-table [dataSource]="objects()" class="mat-elevation-z0">
        <ng-container matColumnDef="key">
          <th mat-header-cell *matHeaderCellDef>Key</th>
          <td mat-cell *matCellDef="let obj">
            <code class="key">{{ obj.key }}</code>
          </td>
        </ng-container>

        <ng-container matColumnDef="size">
          <th mat-header-cell *matHeaderCellDef>Size</th>
          <td mat-cell *matCellDef="let obj">{{ formatBytes(obj.sizeBytes) }}</td>
        </ng-container>

        <ng-container matColumnDef="lastModified">
          <th mat-header-cell *matHeaderCellDef>Last modified</th>
          <td mat-cell *matCellDef="let obj">{{ obj.lastModifiedIso }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let obj" class="actions">
            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Object actions">
              <mat-icon aria-hidden="true">more_vert</mat-icon>
            </button>

            <mat-menu #menu="matMenu">
              <button mat-menu-item type="button" (click)="moveObject(obj)">
                <mat-icon aria-hidden="true">drive_file_move</mat-icon>
                <span>Move</span>
              </button>
              <button mat-menu-item type="button" (click)="deleteObject(obj)">
                <mat-icon aria-hidden="true">delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </mat-card-content>
</mat-card>
